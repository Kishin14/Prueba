<?php
require_once("../../../framework/clases/DbClass.php");
require_once("../../../framework/clases/PermisosFormClass.php");

final class reportesContratosModel extends Db{

  private $UserId;
  private $Permisos;
  
  public function SetUsuarioId($UserId,$CodCId){	  
	$this -> Permisos = new PermisosForm();
	$this -> Permisos -> SetUsuarioId($UserId,$CodCId);
  }
  
  public function getPermiso($ActividadId,$Permiso,$Conex){
	  return $this -> Permisos -> getPermiso($ActividadId,$Permiso,$Conex);
  }
  
   public function GetSi_Pro($Conex){
	$opciones=array(0=>array('value'=>'1','text'=>'UNO'),1=>array('value'=>'ALL','text'=>'TODOS'));
	return $opciones;
   }
   
    public function GetSi_Pro2($Conex){
	$opciones=array(0=>array('value'=>'1','text'=>'UNO'),1=>array('value'=>'ALL','text'=>'TODOS'));
	return $opciones;
   }
   
  public function getReporteMC1($desde,$hasta,$Conex){ 	   	
 
	    $select = "SELECT 'MC' AS tipo_documento, m.manifiesto AS numero_documento, m.fecha_mc AS fecha_manifiesto, 
		CASE m.estado WHEN 'L' THEN 'LIQUIDADO' WHEN 'A' THEN 'ANULADO' WHEN 'M' THEN 'MANIFESTADO' WHEN 'P' THEN 'PENDIENTE' END AS estado_manifiesto,
		(SELECT consecutivo FROM encabezado_de_registro WHERE encabezado_registro_id = am.encabezado_registro_id) AS numero_egreso, date(am.fecha_egreso) AS fecha_anticipo,		 
		IF(am.encabezado_registro_id >= 0,'SI','NO') AS contabilizado, am.tenedor AS tenedor, am.conductor AS conductor, am.valor AS valor, 
		m.placa AS placa, (SELECT IF(estado ='C','CONTABILIZADO','ANULADO') AS estado_encabezado FROM encabezado_de_registro 
		WHERE encabezado_registro_id = am.encabezado_registro_id) AS estado_encabezado FROM anticipos_manifiesto am ,manifiesto m WHERE am.manifiesto_id = m.manifiesto_id 
		AND m.manifiesto_id = m.manifiesto_id AND m.fecha_mc BETWEEN '$desde' AND '$hasta' ORDER BY m.placa_id";		  
		  
		  //echo $select;		  
		  $results = $this -> DbFetchAll($select,$Conex);
		  return $results;
  } 
  
}

?>